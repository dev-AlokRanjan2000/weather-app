<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <title>Neon Glass Weather UI</title>
</head>
<body>
  <div class="weather-ui">

    <!-- Search Bar with Suggestions and Location Button -->
    <div class="search">
      <div class="search-input-wrapper">
        <input type="text" id="city-input" placeholder="Enter city name" spellcheck="false" autocomplete="off" />
        <ul id="suggestions" class="suggestions-list"></ul>
      </div>
      <button id="search-btn" title="Search">🔍</button>
      <button id="location-btn" title="Use My Location">📍</button>
    </div>

    <!-- Loading Spinner -->
    <div id="loading" class="loading-spinner hidden"></div>

    <!-- Main Weather Card -->
    <div class="main-card">
      <div class="location-time">
        <h2 class="city">Delhi</h2>
        <span class="clock">--:--</span>
      </div>
      <div class="current-weather">
        <div class="weather-icon-wrap">
          <img src="images/cloudy.png" alt="Weather Icon" class="weather-icon" />
          <span class="sun-glow"></span>
        </div>
        <div class="temp">--°c</div>
        <div class="desc">Loading...</div>
      </div>
    </div>

    <!-- Status Module -->
    <div class="status-module">
      <h3>Weather Stats</h3>
      <div class="stats">
        <div class="stat">
          <img src="images/temp.png" alt="Temperature" />
          <div class="stat-label">Today</div>
          <div class="value today">--°c</div>
        </div>
        <div class="stat">
          <img src="images/humidity.png" alt="Humidity" />
          <div class="stat-label">Humidity</div>
          <div class="value humidity">--%</div>
        </div>
        <div class="stat">
          <img src="images/wind.png" alt="Wind" />
          <div class="stat-label">Wind</div>
          <div class="value wind">--Km/h</div>
        </div>
      </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast" class="toast"></div>
  </div>

  <script>
    const apiKey = "bfa52ed490b0ed7dc73ef8f83059ab54"; // OpenWeatherMap API key
    const geoapifyKey = "2a9c5eb650ec4891bbc8b04e93d05081"; // Geoapify API key

    const cityInput = document.getElementById("city-input");
    const searchBtn = document.getElementById("search-btn");
    const locationBtn = document.getElementById("location-btn");
    const suggestions = document.getElementById("suggestions");
    const loading = document.getElementById("loading");
    const toast = document.getElementById("toast");

    // Show toast message
    function showToast(message, duration = 3000) {
      toast.textContent = message;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), duration);
    }

    // Show/Hide loading spinner
    function setLoading(visible) {
      loading.classList.toggle("hidden", !visible);
    }

    // Fetch weather using OpenWeatherMap API (current weather only)
    async function fetchWeather(city) {
      if (!city) {
        showToast("Please enter a city name");
        return;
      }
      setLoading(true);
      try {
        const weatherRes = await fetch(
          `https://api.openweathermap.org/data/2.5/weather?units=metric&q=${city}&appid=${apiKey}`
        );
        const weather = await weatherRes.json();
        if (weather.cod === "404") {
          setLoading(false);
          showToast("City not found. Please enter a valid city name.");
          return;
        }

        // Update current weather UI
        document.querySelector(".city").textContent = weather.name;
        const now = new Date();
        document.querySelector(".clock").textContent = now.toLocaleTimeString([], {
          hour: '2-digit',
          minute: '2-digit'
        });
        document.querySelector(".temp").textContent = Math.round(weather.main.temp) + "°c";
        document.querySelector(".today").textContent = Math.round(weather.main.temp) + "°c";
        document.querySelector(".humidity").textContent = weather.main.humidity + "%";
        document.querySelector(".wind").textContent = weather.wind.speed + "Km/h";
        document.querySelector(".desc").textContent = weather.weather[0].description;

        document.querySelector(".weather-icon").src =
          `https://openweathermap.org/img/wn/${weather.weather[0].icon}@2x.png`;
        document.querySelector(".weather-icon").alt = weather.weather[0].description;

        setLoading(false);
        showToast(`Weather data updated for ${weather.name}`, 2000);
      } catch (error) {
        setLoading(false);
        showToast("Failed to fetch weather data");
        console.error(error);
      }
    }

    // Autocomplete Suggestions from Geoapify API
    cityInput.addEventListener("input", async () => {
      const query = cityInput.value.trim();
      if (query.length < 2) {
        suggestions.innerHTML = "";
        suggestions.classList.remove("show");
        return;
      }
      const url = `https://api.geoapify.com/v1/geocode/autocomplete?text=${encodeURIComponent(query)}&apiKey=${geoapifyKey}`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        suggestions.innerHTML = "";

        if (data.features && data.features.length) {
          data.features.forEach(feature => {
            const props = feature.properties;
            const cityName = props.city || props.county || props.state || props.name;
            const country = props.country;
            if (cityName && country) {
              const li = document.createElement("li");
              li.textContent = `${cityName}, ${country}`;
              li.addEventListener("click", () => {
                cityInput.value = li.textContent;
                suggestions.innerHTML = "";
                suggestions.classList.remove("show");
                fetchWeather(li.textContent);
              });
              suggestions.appendChild(li);
            }
          });
          suggestions.classList.add("show");
        } else {
          suggestions.classList.remove("show");
        }
      } catch (error) {
        console.error("Autocomplete error: ", error);
        suggestions.innerHTML = "";
        suggestions.classList.remove("show");
      }
    });

    // Search button and Enter key handlers
    searchBtn.addEventListener("click", () => {
      suggestions.innerHTML = "";
      suggestions.classList.remove("show");
      fetchWeather(cityInput.value.trim());
    });

    cityInput.addEventListener("keypress", e => {
      if (e.key === "Enter") {
        suggestions.innerHTML = "";
        suggestions.classList.remove("show");
        fetchWeather(cityInput.value.trim());
      }
    });

    // Use current location
    locationBtn.addEventListener("click", () => {
      if (!navigator.geolocation) {
        showToast("Geolocation is not supported by your browser");
        return;
      }
      setLoading(true);
      navigator.geolocation.getCurrentPosition(async position => {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        try {
          const res = await fetch(
            `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${apiKey}`
          );
          const data = await res.json();
          if (data.cod === "404") {
            setLoading(false);
            showToast("Unable to get weather for your location");
            return;
          }
          cityInput.value = data.name;
          fetchWeather(data.name);
        } catch (error) {
          setLoading(false);
          showToast("Failed to fetch weather data");
        }
      }, () => {
        setLoading(false);
        showToast("Permission denied to access location");
      });
    });

    // Load default city weather on page load
    fetchWeather("Delhi");.

  </script>
</body>
</html>
